<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionnaire Diagnostic | Tunisian Campers</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;600;700&family=Noto+Sans+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        /* ══════════════════════════════════════════════════════════
           CSS VARIABLES - Material Design 3 Tokens
           ══════════════════════════════════════════════════════════ */
        :root {
            /* Primary Colors - Teal Theme */
            --primary: #45998A;
            --primary-light: #6DBBAA;
            --primary-pale: #DAF3E0;
            --primary-dark: #267675;

            /* Secondary Colors */
            --secondary: #4A8EBF;
            --secondary-light: #8DC7DE;
            --secondary-pale: #DBECF4;

            /* Accent Colors */
            --accent: #79409E;
            --accent-light: #AF93C6;
            --accent-pale: #F3E3FE;

            /* Semantic Colors */
            --success: #549F3A;
            --warning: #F48E40;
            --error: #E65655;

            /* Neutrals */
            --white: #FFFFFF;
            --gray-50: #F8F9FA;
            --gray-100: #E8E8E8;
            --gray-200: #D1D1D1;
            --gray-300: #A2A2A2;
            --gray-400: #7E7E7E;
            --gray-500: #5B5B5B;
            --gray-900: #1C1B1F;

            /* Typography */
            --font-display: 'Noto Sans Display', sans-serif;
            --font-body: 'Noto Sans', sans-serif;

            /* Spacing */
            --spacing-1: 4px;
            --spacing-2: 8px;
            --spacing-3: 12px;
            --spacing-4: 16px;
            --spacing-5: 20px;
            --spacing-6: 24px;
            --spacing-8: 32px;
            --spacing-10: 40px;
            --spacing-12: 48px;

            /* Border Radius */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;

            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
        }

        /* ══════════════════════════════════════════════════════════
           BASE STYLES
           ══════════════════════════════════════════════════════════ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-body);
            font-size: 16px;
            line-height: 1.6;
            color: var(--gray-900);
            background-color: var(--gray-50);
        }

        /* ══════════════════════════════════════════════════════════
           HEADER
           ══════════════════════════════════════════════════════════ */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            padding: var(--spacing-12) var(--spacing-6);
            text-align: center;
        }

        .header-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .company-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-2);
            background: rgba(255,255,255,0.2);
            padding: var(--spacing-2) var(--spacing-4);
            border-radius: var(--radius-xl);
            font-size: 14px;
            font-weight: 500;
            margin-bottom: var(--spacing-6);
        }

        .header h1 {
            font-family: var(--font-display);
            font-size: 36px;
            font-weight: 600;
            margin-bottom: var(--spacing-4);
        }

        .header .subtitle {
            font-size: 18px;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        /* ══════════════════════════════════════════════════════════
           NAVIGATION
           ══════════════════════════════════════════════════════════ */
        .nav-container {
            background: var(--white);
            border-bottom: 1px solid var(--gray-100);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .nav-content {
            max-width: 1000px;
            margin: 0 auto;
            padding: var(--spacing-4) var(--spacing-6);
            display: flex;
            gap: var(--spacing-3);
            overflow-x: auto;
            justify-content: center;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
            padding: var(--spacing-2) var(--spacing-4);
            background: var(--gray-50);
            border: 1px solid var(--gray-100);
            border-radius: var(--radius-xl);
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-500);
            text-decoration: none;
            white-space: nowrap;
            transition: all 0.2s ease;
        }

        .nav-item:hover {
            background: var(--primary-pale);
            border-color: var(--primary-light);
            color: var(--primary-dark);
        }

        .nav-item .material-icons {
            font-size: 18px;
        }

        /* ══════════════════════════════════════════════════════════
           MAIN CONTENT
           ══════════════════════════════════════════════════════════ */
        .main-content {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--spacing-8) var(--spacing-6);
        }

        /* ══════════════════════════════════════════════════════════
           INTRODUCTION
           ══════════════════════════════════════════════════════════ */
        .intro-section {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--spacing-8);
            margin-bottom: var(--spacing-8);
            box-shadow: var(--shadow-md);
        }

        .intro-section h2 {
            font-family: var(--font-display);
            font-size: 24px;
            color: var(--primary-dark);
            margin-bottom: var(--spacing-4);
        }

        .intro-section p {
            color: var(--gray-500);
            margin-bottom: var(--spacing-4);
        }

        .intro-section ul {
            list-style: none;
            padding: 0;
        }

        .intro-section li {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-3);
            padding: var(--spacing-3) 0;
            border-bottom: 1px solid var(--gray-100);
        }

        .intro-section li:last-child {
            border-bottom: none;
        }

        .intro-section li .material-icons {
            color: var(--primary);
            font-size: 20px;
            margin-top: 2px;
        }

        .time-estimate {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-2);
            background: var(--success);
            color: var(--white);
            padding: var(--spacing-2) var(--spacing-4);
            border-radius: var(--radius-xl);
            font-size: 14px;
            font-weight: 500;
            margin-top: var(--spacing-4);
        }

        .save-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: var(--spacing-4);
            padding-top: var(--spacing-4);
            border-top: 1px solid var(--gray-100);
        }

        .save-indicator {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-2);
            color: var(--success);
            font-size: 14px;
            font-weight: 500;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .btn-clear {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-2);
            padding: var(--spacing-2) var(--spacing-4);
            background: transparent;
            color: var(--gray-400);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-xl);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-clear:hover {
            background: var(--error);
            color: var(--white);
            border-color: var(--error);
        }

        /* ══════════════════════════════════════════════════════════
           FORM SECTIONS
           ══════════════════════════════════════════════════════════ */
        .form-section {
            background: var(--white);
            border-radius: var(--radius-lg);
            margin-bottom: var(--spacing-8);
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            padding: var(--spacing-6);
            display: flex;
            align-items: center;
            gap: var(--spacing-4);
        }

        .section-header.secondary {
            background: linear-gradient(135deg, var(--secondary) 0%, #34659F 100%);
        }

        .section-header.accent {
            background: linear-gradient(135deg, var(--accent) 0%, #5a2d78 100%);
        }

        .section-header.warning {
            background: linear-gradient(135deg, var(--warning) 0%, #E15720 100%);
        }

        .section-icon {
            width: 48px;
            height: 48px;
            background: rgba(255,255,255,0.2);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .section-icon .material-icons {
            font-size: 28px;
        }

        .section-title h2 {
            font-family: var(--font-display);
            font-size: 22px;
            font-weight: 600;
            margin-bottom: var(--spacing-1);
        }

        .section-title p {
            font-size: 14px;
            opacity: 0.9;
        }

        .section-body {
            padding: var(--spacing-6);
        }

        /* ══════════════════════════════════════════════════════════
           FORM ELEMENTS
           ══════════════════════════════════════════════════════════ */
        .form-group {
            margin-bottom: var(--spacing-6);
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--spacing-2);
        }

        .form-label .required {
            color: var(--error);
            margin-left: var(--spacing-1);
        }

        .form-hint {
            font-size: 14px;
            color: var(--gray-400);
            margin-bottom: var(--spacing-3);
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: var(--spacing-3) var(--spacing-4);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-sm);
            font-family: var(--font-body);
            font-size: 16px;
            color: var(--gray-900);
            background: var(--white);
            transition: all 0.2s ease;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-pale);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='%237E7E7E' d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 40px;
        }

        /* Input with unit */
        .input-with-unit {
            display: flex;
            align-items: stretch;
        }

        .input-with-unit .form-input {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            border-right: none;
        }

        .input-unit {
            display: flex;
            align-items: center;
            padding: 0 var(--spacing-4);
            background: var(--gray-100);
            border: 1px solid var(--gray-200);
            border-left: none;
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
            font-size: 14px;
            color: var(--gray-500);
            white-space: nowrap;
        }

        /* Grid layouts */
        .form-grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-4);
        }

        .form-grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-4);
        }

        .form-grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--spacing-4);
        }

        @media (max-width: 768px) {
            .form-grid-2,
            .form-grid-3,
            .form-grid-4 {
                grid-template-columns: 1fr;
            }
        }

        /* Checkbox and Radio */
        .checkbox-group,
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-3);
        }

        .checkbox-inline,
        .radio-inline {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-4);
        }

        .checkbox-item,
        .radio-item {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-3);
            padding: var(--spacing-3) var(--spacing-4);
            background: var(--gray-50);
            border: 1px solid var(--gray-100);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .checkbox-item:hover,
        .radio-item:hover {
            background: var(--primary-pale);
            border-color: var(--primary-light);
        }

        .checkbox-item input,
        .radio-item input {
            margin-top: 2px;
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
        }

        .checkbox-item label,
        .radio-item label {
            cursor: pointer;
            flex: 1;
        }

        /* Data table input */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--spacing-3);
        }

        .data-table th,
        .data-table td {
            padding: var(--spacing-3);
            border: 1px solid var(--gray-200);
            text-align: left;
        }

        .data-table th {
            background: var(--gray-100);
            font-weight: 600;
            font-size: 14px;
        }

        .data-table td input,
        .data-table td select {
            width: 100%;
            padding: var(--spacing-2);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-sm);
            font-size: 14px;
        }

        .data-table td input:focus,
        .data-table td select:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Subsection */
        .subsection {
            background: var(--gray-50);
            border-radius: var(--radius-md);
            padding: var(--spacing-5);
            margin-bottom: var(--spacing-6);
        }

        .subsection:last-child {
            margin-bottom: 0;
        }

        .subsection-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: var(--spacing-4);
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
        }

        .subsection-title .material-icons {
            font-size: 20px;
        }

        /* ══════════════════════════════════════════════════════════
           FILE UPLOAD
           ══════════════════════════════════════════════════════════ */
        .file-upload-area {
            border: 2px dashed var(--gray-300);
            border-radius: var(--radius-md);
            padding: var(--spacing-8);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--white);
        }

        .file-upload-area:hover,
        .file-upload-area.dragover {
            border-color: var(--primary);
            background: var(--primary-pale);
        }

        .file-upload-icon {
            font-size: 48px;
            color: var(--gray-300);
            margin-bottom: var(--spacing-3);
        }

        .file-upload-area:hover .file-upload-icon,
        .file-upload-area.dragover .file-upload-icon {
            color: var(--primary);
        }

        .file-upload-text {
            font-size: 16px;
            font-weight: 500;
            color: var(--gray-500);
            margin-bottom: var(--spacing-1);
        }

        .file-upload-hint {
            font-size: 13px;
            color: var(--gray-400);
        }

        .file-input-hidden {
            position: absolute;
            left: -9999px;
            opacity: 0;
        }

        .file-list {
            margin-top: var(--spacing-4);
        }

        .file-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-3);
            padding: var(--spacing-3) var(--spacing-4);
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-sm);
            margin-bottom: var(--spacing-2);
        }

        .file-item .material-icons {
            color: var(--accent);
            font-size: 24px;
        }

        .file-item-info {
            flex: 1;
        }

        .file-item-name {
            font-weight: 500;
            font-size: 14px;
            color: var(--gray-900);
        }

        .file-item-size {
            font-size: 12px;
            color: var(--gray-400);
        }

        .file-item-remove {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--gray-400);
            padding: var(--spacing-1);
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .file-item-remove:hover {
            background: var(--error);
            color: var(--white);
        }

        .document-suggestions {
            margin-top: var(--spacing-5);
            padding: var(--spacing-4);
            background: var(--accent-pale);
            border-radius: var(--radius-md);
            border-left: 4px solid var(--accent);
        }

        .suggestion-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: var(--spacing-3);
        }

        .suggestion-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
            font-size: 13px;
            color: var(--gray-600);
        }

        .suggestion-item .material-icons {
            font-size: 18px;
            color: var(--accent);
        }

        /* ══════════════════════════════════════════════════════════
           SUBMIT SECTION
           ══════════════════════════════════════════════════════════ */
        .submit-section {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--spacing-8);
            margin-bottom: var(--spacing-8);
            box-shadow: var(--shadow-md);
            text-align: center;
        }

        .submit-section h2 {
            font-family: var(--font-display);
            font-size: 24px;
            color: var(--gray-900);
            margin-bottom: var(--spacing-4);
        }

        .submit-section p {
            color: var(--gray-500);
            margin-bottom: var(--spacing-6);
        }

        .btn-submit {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-3);
            padding: var(--spacing-4) var(--spacing-8);
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            border: none;
            border-radius: var(--radius-xl);
            font-family: var(--font-body);
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-submit .material-icons {
            font-size: 24px;
        }

        /* ══════════════════════════════════════════════════════════
           FOOTER
           ══════════════════════════════════════════════════════════ */
        .footer {
            background: var(--gray-900);
            color: var(--white);
            padding: var(--spacing-8) var(--spacing-6);
            text-align: center;
        }

        .footer p {
            opacity: 0.7;
            font-size: 14px;
        }

        /* ══════════════════════════════════════════════════════════
           RESPONSIVE
           ══════════════════════════════════════════════════════════ */
        @media (max-width: 768px) {
            .header {
                padding: var(--spacing-8) var(--spacing-4);
            }

            .header h1 {
                font-size: 28px;
            }

            .main-content {
                padding: var(--spacing-4);
            }

            .section-header {
                flex-direction: column;
                text-align: center;
            }

            .section-body {
                padding: var(--spacing-4);
            }

            .data-table {
                font-size: 14px;
            }

            .data-table th,
            .data-table td {
                padding: var(--spacing-2);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="company-badge">
                <span class="material-icons">eco</span>
                Tunisian Campers
            </div>
            <h1>Questionnaire Diagnostic</h1>
            <p class="subtitle">Ce questionnaire court nous permettra de préparer efficacement notre première session stratégique.</p>
        </div>
    </header>

    <!-- Navigation - Simplified to 4 sections -->
    <nav class="nav-container">
        <div class="nav-content">
            <a href="#section-1" class="nav-item">
                <span class="material-icons">payments</span>
                Finances
            </a>
            <a href="#section-2" class="nav-item">
                <span class="material-icons">groups</span>
                Clients
            </a>
            <a href="#section-3" class="nav-item">
                <span class="material-icons">settings</span>
                Capacité
            </a>
            <a href="#section-4" class="nav-item">
                <span class="material-icons">emoji_objects</span>
                Vision
            </a>
            <a href="#section-5" class="nav-item">
                <span class="material-icons">folder_open</span>
                Documents
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Introduction -->
        <div class="intro-section">
            <h2>Instructions</h2>
            <p>Merci de prendre quelques minutes pour remplir ce questionnaire avant notre première réunion. Vos réponses nous aideront à :</p>
            <ul>
                <li>
                    <span class="material-icons">check_circle</span>
                    <span>Comprendre les données clés de Tunisian Campers</span>
                </li>
                <li>
                    <span class="material-icons">check_circle</span>
                    <span>Identifier vos priorités et défis stratégiques</span>
                </li>
                <li>
                    <span class="material-icons">check_circle</span>
                    <span>Maximiser l'efficacité de notre temps ensemble</span>
                </li>
            </ul>
            <div class="time-estimate">
                <span class="material-icons">schedule</span>
                Temps estimé : 10-15 minutes
            </div>

            <div class="save-controls">
                <div id="save-indicator" class="save-indicator">
                    <span class="material-icons" style="font-size: 16px;">info</span>
                    Vos réponses sont sauvegardées automatiquement
                </div>
                <button type="button" class="btn-clear" onclick="clearSavedData()">
                    <span class="material-icons" style="font-size: 16px;">delete_outline</span>
                    Effacer mes réponses
                </button>
            </div>
        </div>

        <form id="diagnostic-form">
            <!-- Section 1: Financial Data (Simplified) -->
            <section class="form-section" id="section-1">
                <div class="section-header">
                    <div class="section-icon">
                        <span class="material-icons">payments</span>
                    </div>
                    <div class="section-title">
                        <h2>Section 1 : Données Financières</h2>
                        <p>Performance financière des 3 dernières années</p>
                    </div>
                </div>

                <div class="section-body">
                    <!-- Revenue by Year (Simplified - 3 years only, no comments) -->
                    <div class="subsection">
                        <div class="subsection-title">
                            <span class="material-icons">trending_up</span>
                            Chiffre d'Affaires Annuel
                        </div>

                        <div class="form-group">
                            <label class="form-label">Chiffre d'affaires par année (en TND)</label>
                            <div class="form-grid-3">
                                <div class="form-group">
                                    <label class="form-label" style="font-weight: 400; font-size: 14px;">2023</label>
                                    <input type="number" class="form-input" name="revenue_2023" placeholder="Ex: 80000">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" style="font-weight: 400; font-size: 14px;">2024</label>
                                    <input type="number" class="form-input" name="revenue_2024" placeholder="Ex: 120000">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" style="font-weight: 400; font-size: 14px;">2025 (estimé)</label>
                                    <input type="number" class="form-input" name="revenue_2025" placeholder="Ex: 150000">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Revenue by Service (Simplified - name + % only) -->
                    <div class="subsection">
                        <div class="subsection-title">
                            <span class="material-icons">category</span>
                            Répartition par Service
                        </div>

                        <div class="form-group">
                            <label class="form-label">Vos principaux services et leur part du CA</label>
                            <p class="form-hint">Listez vos 4 offres principales avec leur pourcentage du chiffre d'affaires</p>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Service/Produit</th>
                                        <th style="width: 100px;">% du CA</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><input type="text" name="service_1_name" placeholder="Ex: Tours camping guidés"></td>
                                        <td><input type="number" name="service_1_percent" placeholder="%" min="0" max="100"></td>
                                    </tr>
                                    <tr>
                                        <td><input type="text" name="service_2_name" placeholder="Ex: Retraites bien-être"></td>
                                        <td><input type="number" name="service_2_percent" placeholder="%" min="0" max="100"></td>
                                    </tr>
                                    <tr>
                                        <td><input type="text" name="service_3_name" placeholder="Ex: Team building"></td>
                                        <td><input type="number" name="service_3_percent" placeholder="%" min="0" max="100"></td>
                                    </tr>
                                    <tr>
                                        <td><input type="text" name="service_4_name" placeholder="Ex: Expériences privées"></td>
                                        <td><input type="number" name="service_4_percent" placeholder="%" min="0" max="100"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Profitability (Simplified - gross margin only) -->
                    <div class="subsection">
                        <div class="subsection-title">
                            <span class="material-icons">account_balance</span>
                            Rentabilité
                        </div>

                        <div class="form-group">
                            <label class="form-label">Marge brute moyenne</label>
                            <p class="form-hint">Pourcentage approximatif (CA - coûts directs) / CA</p>
                            <div class="input-with-unit" style="max-width: 200px;">
                                <input type="number" class="form-input" name="gross_margin" placeholder="Ex: 45" min="0" max="100">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Seasonality (Simplified - dropdowns only, no percentages) -->
                    <div class="subsection">
                        <div class="subsection-title">
                            <span class="material-icons">date_range</span>
                            Saisonnalité
                        </div>

                        <div class="form-group">
                            <label class="form-label">Niveau d'activité par trimestre</label>
                            <div class="form-grid-4">
                                <div class="form-group">
                                    <label class="form-label" style="font-weight: 400; font-size: 14px;">Jan-Mars</label>
                                    <select class="form-select" name="season_q1_level">
                                        <option value="">Sélectionner...</option>
                                        <option value="very_low">Très faible</option>
                                        <option value="low">Faible</option>
                                        <option value="medium">Moyen</option>
                                        <option value="high">Élevé</option>
                                        <option value="very_high">Très élevé</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" style="font-weight: 400; font-size: 14px;">Avr-Juin</label>
                                    <select class="form-select" name="season_q2_level">
                                        <option value="">Sélectionner...</option>
                                        <option value="very_low">Très faible</option>
                                        <option value="low">Faible</option>
                                        <option value="medium">Moyen</option>
                                        <option value="high">Élevé</option>
                                        <option value="very_high">Très élevé</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" style="font-weight: 400; font-size: 14px;">Jul-Sept</label>
                                    <select class="form-select" name="season_q3_level">
                                        <option value="">Sélectionner...</option>
                                        <option value="very_low">Très faible</option>
                                        <option value="low">Faible</option>
                                        <option value="medium">Moyen</option>
                                        <option value="high">Élevé</option>
                                        <option value="very_high">Très élevé</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" style="font-weight: 400; font-size: 14px;">Oct-Déc</label>
                                    <select class="form-select" name="season_q4_level">
                                        <option value="">Sélectionner...</option>
                                        <option value="very_low">Très faible</option>
                                        <option value="low">Faible</option>
                                        <option value="medium">Moyen</option>
                                        <option value="high">Élevé</option>
                                        <option value="very_high">Très élevé</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 2: Customer Data (Simplified) -->
            <section class="form-section" id="section-2">
                <div class="section-header secondary">
                    <div class="section-icon">
                        <span class="material-icons">groups</span>
                    </div>
                    <div class="section-title">
                        <h2>Section 2 : Vos Clients</h2>
                        <p>Comprendre votre base client</p>
                    </div>
                </div>

                <div class="section-body">
                    <!-- Customer Volume (Simplified) -->
                    <div class="subsection">
                        <div class="subsection-title">
                            <span class="material-icons">people</span>
                            Volume et Valeur
                        </div>

                        <div class="form-grid-3">
                            <div class="form-group">
                                <label class="form-label">Nombre de clients en 2025</label>
                                <input type="number" class="form-input" name="customers_2025" placeholder="Ex: 500">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Panier moyen par client</label>
                                <div class="input-with-unit">
                                    <input type="number" class="form-input" name="avg_basket" placeholder="Ex: 350">
                                    <span class="input-unit">TND</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Taux de clients récurrents</label>
                                <div class="input-with-unit">
                                    <input type="number" class="form-input" name="repeat_rate" placeholder="Ex: 25" min="0" max="100">
                                    <span class="input-unit">%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Demographics (Simplified) -->
                    <div class="subsection">
                        <div class="subsection-title">
                            <span class="material-icons">diversity_3</span>
                            Profil Client
                        </div>

                        <div class="form-group">
                            <label class="form-label">Répartition par origine</label>
                            <p class="form-hint">Pourcentages approximatifs (total = 100%)</p>
                            <div class="form-grid-3">
                                <div class="form-group">
                                    <label class="form-label" style="font-weight: 400; font-size: 14px;">Tunisiens</label>
                                    <div class="input-with-unit">
                                        <input type="number" class="form-input" name="customers_tunisian" placeholder="%" min="0" max="100">
                                        <span class="input-unit">%</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" style="font-weight: 400; font-size: 14px;">Européens</label>
                                    <div class="input-with-unit">
                                        <input type="number" class="form-input" name="customers_european" placeholder="%" min="0" max="100">
                                        <span class="input-unit">%</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" style="font-weight: 400; font-size: 14px;">Autres</label>
                                    <div class="input-with-unit">
                                        <input type="number" class="form-input" name="customers_other" placeholder="%" min="0" max="100">
                                        <span class="input-unit">%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Types de groupes principaux</label>
                            <p class="form-hint">Sélectionnez les 2-3 types les plus fréquents</p>
                            <div class="checkbox-group checkbox-inline">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="group_families" name="customer_types" value="families">
                                    <label for="group_families">Familles</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="group_couples" name="customer_types" value="couples">
                                    <label for="group_couples">Couples</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="group_solo" name="customer_types" value="solo">
                                    <label for="group_solo">Voyageurs solo</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="group_friends" name="customer_types" value="friends">
                                    <label for="group_friends">Groupes d'amis</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="group_corporate" name="customer_types" value="corporate">
                                    <label for="group_corporate">Entreprises</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="group_schools" name="customer_types" value="schools">
                                    <label for="group_schools">Écoles/Associations</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 3: Capacity & Team (Simplified) -->
            <section class="form-section" id="section-3">
                <div class="section-header accent">
                    <div class="section-icon">
                        <span class="material-icons">settings</span>
                    </div>
                    <div class="section-title">
                        <h2>Section 3 : Capacité & Équipe</h2>
                        <p>Vos ressources et contraintes</p>
                    </div>
                </div>

                <div class="section-body">
                    <!-- Capacity (Simplified) -->
                    <div class="subsection">
                        <div class="subsection-title">
                            <span class="material-icons">speed</span>
                            Capacité
                        </div>

                        <div class="form-grid-2">
                            <div class="form-group">
                                <label class="form-label">Capacité maximale par semaine</label>
                                <p class="form-hint">Nombre de clients que vous pouvez servir</p>
                                <input type="number" class="form-input" name="weekly_capacity" placeholder="Ex: 50">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Taux d'utilisation moyen</label>
                                <p class="form-hint">Remplissage réel vs capacité</p>
                                <div class="input-with-unit">
                                    <input type="number" class="form-input" name="utilization_rate" placeholder="Ex: 65" min="0" max="100">
                                    <span class="input-unit">%</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Principaux facteurs limitant votre capacité</label>
                            <div class="checkbox-group checkbox-inline">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="limit_vehicles" name="capacity_limits" value="vehicles">
                                    <label for="limit_vehicles">Véhicules</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="limit_equipment" name="capacity_limits" value="equipment">
                                    <label for="limit_equipment">Équipement camping</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="limit_staff" name="capacity_limits" value="staff">
                                    <label for="limit_staff">Personnel/Guides</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="limit_permits" name="capacity_limits" value="permits">
                                    <label for="limit_permits">Autorisations</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="limit_demand" name="capacity_limits" value="demand">
                                    <label for="limit_demand">Demande insuffisante</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="limit_time" name="capacity_limits" value="time">
                                    <label for="limit_time">Temps personnel</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Team (Simplified) -->
                    <div class="subsection">
                        <div class="subsection-title">
                            <span class="material-icons">badge</span>
                            Équipe
                        </div>

                        <div class="form-grid-3">
                            <div class="form-group">
                                <label class="form-label">Temps plein</label>
                                <input type="number" class="form-input" name="staff_fulltime" placeholder="Ex: 2">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Temps partiel</label>
                                <input type="number" class="form-input" name="staff_parttime" placeholder="Ex: 3">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Saisonniers</label>
                                <input type="number" class="form-input" name="staff_seasonal" placeholder="Ex: 5">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Services externalisés</label>
                            <div class="checkbox-group checkbox-inline">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="outsource_guides" name="outsourced" value="guides">
                                    <label for="outsource_guides">Guides freelance</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="outsource_transport" name="outsourced" value="transport">
                                    <label for="outsource_transport">Transport</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="outsource_catering" name="outsourced" value="catering">
                                    <label for="outsource_catering">Restauration</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="outsource_accounting" name="outsourced" value="accounting">
                                    <label for="outsource_accounting">Comptabilité</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="outsource_marketing" name="outsourced" value="marketing">
                                    <label for="outsource_marketing">Marketing</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 4: Vision (Simplified) -->
            <section class="form-section" id="section-4">
                <div class="section-header warning">
                    <div class="section-icon">
                        <span class="material-icons">emoji_objects</span>
                    </div>
                    <div class="section-title">
                        <h2>Section 4 : Votre Vision</h2>
                        <p>Vos défis et aspirations</p>
                    </div>
                </div>

                <div class="section-body">
                    <!-- Challenges -->
                    <div class="subsection">
                        <div class="subsection-title">
                            <span class="material-icons">report_problem</span>
                            Défis Actuels
                        </div>

                        <div class="form-group">
                            <label class="form-label">Quels sont vos 3 plus grands défis actuellement ?</label>
                            <textarea class="form-textarea" name="top_challenges" placeholder="1. ...\n2. ...\n3. ..."></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Qu'est-ce qui vous empêche de dormir la nuit ?</label>
                            <p class="form-hint">Votre plus grande préoccupation business</p>
                            <textarea class="form-textarea" name="biggest_worry" placeholder="Soyez honnête - qu'est-ce qui vous inquiète le plus ?"></textarea>
                        </div>
                    </div>

                    <!-- Future Vision -->
                    <div class="subsection">
                        <div class="subsection-title">
                            <span class="material-icons">rocket_launch</span>
                            Vision Future
                        </div>

                        <div class="form-group">
                            <label class="form-label">Où voyez-vous Tunisian Campers dans 10 ans ?</label>
                            <p class="form-hint">Décrivez votre vision idéale</p>
                            <textarea class="form-textarea" name="vision_10_years" placeholder="Si tout se passe parfaitement, à quoi ressemble Tunisian Campers en 2035 ?"></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Quel rôle voulez-vous jouer dans l'entreprise à l'avenir ?</label>
                            <select class="form-select" name="future_role">
                                <option value="">Sélectionner...</option>
                                <option value="hands_on">Rester très impliqué dans les opérations quotidiennes</option>
                                <option value="strategic">Me concentrer sur la stratégie, déléguer les opérations</option>
                                <option value="investor">Devenir plus investisseur que gestionnaire</option>
                                <option value="exit">Préparer une vente ou transmission</option>
                                <option value="unsure">Je ne suis pas encore sûr</option>
                            </select>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 5: Documents (Optional) -->
            <section class="form-section" id="section-5">
                <div class="section-header accent">
                    <div class="section-icon">
                        <span class="material-icons">folder_open</span>
                    </div>
                    <div class="section-title">
                        <h2>Section 5 : Documents (Optionnel)</h2>
                        <p>Partagez vos documents pour enrichir notre analyse</p>
                    </div>
                </div>

                <div class="section-body">
                    <div class="subsection">
                        <div class="subsection-title">
                            <span class="material-icons">attach_file</span>
                            Documents Utiles
                        </div>

                        <p class="form-hint" style="margin-bottom: 16px;">
                            Si vous disposez de documents existants, ils nous aideront à mieux comprendre votre situation.
                            <strong>Cette section est entièrement optionnelle.</strong>
                        </p>

                        <div style="background: #E8F5E9; border: 1px solid #81C784; border-radius: 8px; padding: 12px 16px; margin-bottom: 16px; display: flex; align-items: center; gap: 12px;">
                            <span class="material-icons" style="color: #4CAF50;">cloud_upload</span>
                            <span style="font-size: 13px; color: #2E7D32;">Vos documents seront automatiquement téléchargés vers Google Drive lors de la soumission.</span>
                        </div>

                        <div class="file-upload-area" id="fileUploadArea">
                            <div class="file-upload-content">
                                <span class="material-icons file-upload-icon">cloud_upload</span>
                                <p class="file-upload-text">Sélectionnez vos fichiers pour les lister</p>
                                <p class="file-upload-hint">PDF, Excel, Word, PowerPoint (max 10 Mo par fichier)</p>
                                <input type="file" id="fileInput" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.csv" class="file-input-hidden">
                            </div>
                        </div>

                        <div class="file-list" id="fileList"></div>

                        <div class="document-suggestions">
                            <p class="form-label" style="margin-bottom: 12px;">Documents suggérés (si disponibles) :</p>
                            <div class="suggestion-grid">
                                <div class="suggestion-item">
                                    <span class="material-icons">description</span>
                                    <span>Bilans financiers</span>
                                </div>
                                <div class="suggestion-item">
                                    <span class="material-icons">table_chart</span>
                                    <span>Données clients (Excel)</span>
                                </div>
                                <div class="suggestion-item">
                                    <span class="material-icons">analytics</span>
                                    <span>Rapports de performance</span>
                                </div>
                                <div class="suggestion-item">
                                    <span class="material-icons">business_center</span>
                                    <span>Business plan existant</span>
                                </div>
                                <div class="suggestion-item">
                                    <span class="material-icons">slideshow</span>
                                    <span>Présentations internes</span>
                                </div>
                                <div class="suggestion-item">
                                    <span class="material-icons">receipt_long</span>
                                    <span>Tarifs / Grilles prix</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group" style="margin-top: 24px;">
                            <label class="form-label">Notes sur les documents</label>
                            <p class="form-hint">Décrivez brièvement les documents que vous joignez</p>
                            <textarea class="form-textarea" name="documents_notes" placeholder="Ex: J'ai joint le bilan 2024, les stats clients de notre CRM, et une présentation faite aux investisseurs..."></textarea>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Submit Section -->
            <div class="submit-section">
                <h2>Prêt à soumettre ?</h2>
                <p>Vérifiez vos réponses avant de soumettre. Vos données sont sauvegardées automatiquement.</p>
                <button type="submit" class="btn-submit">
                    <span class="material-icons">send</span>
                    Soumettre le questionnaire
                </button>
            </div>
        </form>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>Tunisian Campers - Planification Stratégique 2025-2035</p>
        <p style="margin-top: 8px;">Questions ? Contactez votre consultant stratégique.</p>
    </footer>

    <script>
        // ══════════════════════════════════════════════════════════
        // AUTO-SAVE FUNCTIONALITY
        // ══════════════════════════════════════════════════════════
        const STORAGE_KEY = 'tunisian_campers_diagnostic';
        const form = document.getElementById('diagnostic-form');

        // Save form data to localStorage
        function saveToLocalStorage() {
            const formData = new FormData(form);
            const data = {};

            formData.forEach((value, key) => {
                if (data[key]) {
                    if (Array.isArray(data[key])) {
                        data[key].push(value);
                    } else {
                        data[key] = [data[key], value];
                    }
                } else {
                    data[key] = value;
                }
            });

            // Also save checkbox states explicitly
            form.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                if (!data[cb.name]) {
                    data[cb.name] = [];
                }
            });

            data._savedAt = new Date().toISOString();
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            updateSaveIndicator();
        }

        // Load form data from localStorage
        function loadFromLocalStorage() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (!saved) return;

            try {
                const data = JSON.parse(saved);

                Object.keys(data).forEach(key => {
                    if (key === '_savedAt') return;

                    const elements = form.querySelectorAll(`[name="${key}"]`);
                    if (elements.length === 0) return;

                    const value = data[key];

                    elements.forEach(el => {
                        if (el.type === 'checkbox') {
                            const values = Array.isArray(value) ? value : [value];
                            el.checked = values.includes(el.value);
                        } else if (el.type === 'radio') {
                            el.checked = (el.value === value);
                        } else if (el.tagName === 'SELECT' || el.tagName === 'TEXTAREA' || el.type === 'text' || el.type === 'number' || el.type === 'url') {
                            el.value = value || '';
                        }
                    });
                });

                updateSaveIndicator(data._savedAt);
            } catch (e) {
                console.error('Error loading saved data:', e);
            }
        }

        // Update the save indicator
        function updateSaveIndicator(savedAt) {
            const indicator = document.getElementById('save-indicator');
            if (!indicator) return;

            const time = savedAt ? new Date(savedAt) : new Date();
            const timeStr = time.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
            indicator.innerHTML = `<span class="material-icons" style="font-size: 16px;">check_circle</span> Sauvegardé à ${timeStr}`;
            indicator.style.opacity = '1';

            setTimeout(() => {
                indicator.style.opacity = '0.7';
            }, 2000);
        }

        // Clear saved data
        function clearSavedData() {
            if (confirm('Voulez-vous vraiment effacer toutes vos réponses sauvegardées ?')) {
                localStorage.removeItem(STORAGE_KEY);
                form.reset();
                const indicator = document.getElementById('save-indicator');
                if (indicator) {
                    indicator.innerHTML = `<span class="material-icons" style="font-size: 16px;">info</span> Données effacées`;
                }
            }
        }

        // Add event listeners for auto-save
        form.querySelectorAll('input, textarea, select').forEach(el => {
            const eventType = (el.type === 'checkbox' || el.type === 'radio' || el.tagName === 'SELECT') ? 'change' : 'blur';
            el.addEventListener(eventType, saveToLocalStorage);
        });

        // Load saved data on page load
        document.addEventListener('DOMContentLoaded', loadFromLocalStorage);

        // ══════════════════════════════════════════════════════════
        // SMOOTH SCROLL NAVIGATION
        // ══════════════════════════════════════════════════════════
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });

        // ══════════════════════════════════════════════════════════
        // FILE UPLOAD HANDLING
        // ══════════════════════════════════════════════════════════
        const fileUploadArea = document.getElementById('fileUploadArea');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        let uploadedFiles = [];

        if (fileUploadArea && fileInput) {
            // Click to upload
            fileUploadArea.addEventListener('click', () => fileInput.click());

            // Drag and drop events
            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.classList.add('dragover');
            });

            fileUploadArea.addEventListener('dragleave', () => {
                fileUploadArea.classList.remove('dragover');
            });

            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });

            // File input change
            fileInput.addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });
        }

        function handleFiles(files) {
            const maxSize = 10 * 1024 * 1024; // 10 MB
            const allowedTypes = [
                'application/pdf',
                'application/msword',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                'application/vnd.ms-excel',
                'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                'application/vnd.ms-powerpoint',
                'application/vnd.openxmlformats-officedocument.presentationml.presentation',
                'text/csv'
            ];

            Array.from(files).forEach(file => {
                // Check file size
                if (file.size > maxSize) {
                    alert(`Le fichier "${file.name}" dépasse la limite de 10 Mo.`);
                    return;
                }

                // Check if already added
                if (uploadedFiles.some(f => f.name === file.name && f.size === file.size)) {
                    return;
                }

                uploadedFiles.push(file);
            });

            renderFileList();
        }

        function renderFileList() {
            if (!fileList) return;

            if (uploadedFiles.length === 0) {
                fileList.innerHTML = '';
                return;
            }

            fileList.innerHTML = uploadedFiles.map((file, index) => `
                <div class="file-item">
                    <span class="material-icons">${getFileIcon(file.name)}</span>
                    <div class="file-item-info">
                        <div class="file-item-name">${file.name}</div>
                        <div class="file-item-size">${formatFileSize(file.size)}</div>
                    </div>
                    <button type="button" class="file-item-remove" onclick="removeFile(${index})">
                        <span class="material-icons">close</span>
                    </button>
                </div>
            `).join('');
        }

        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const icons = {
                'pdf': 'picture_as_pdf',
                'doc': 'description',
                'docx': 'description',
                'xls': 'table_chart',
                'xlsx': 'table_chart',
                'csv': 'table_chart',
                'ppt': 'slideshow',
                'pptx': 'slideshow'
            };
            return icons[ext] || 'insert_drive_file';
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' o';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' Ko';
            return (bytes / (1024 * 1024)).toFixed(1) + ' Mo';
        }

        // Make removeFile globally accessible for inline onclick
        window.removeFile = function(index) {
            uploadedFiles.splice(index, 1);
            renderFileList();
        }

        // ══════════════════════════════════════════════════════════
        // FORM SUBMISSION - FORMSPREE + GOOGLE DRIVE (Apps Script)
        // ══════════════════════════════════════════════════════════

        const EMAIL_TO = 'rached@datasurf.co';
        const FORMSPREE_ID = 'xaqqnpkl';
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwvnrabXjpCgv6jHd8a_0K1Hd4l6v-3elDt_vn2bAKYgtMhkqk-pVBxlhS2x6K0fW8E/exec';

        // Convert file to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]); // Remove data:...;base64, prefix
                reader.onerror = error => reject(error);
            });
        }

        // Upload all files to Google Drive via Apps Script (batch upload)
        async function uploadAllFilesToGoogleDrive(files) {
            // Convert all files to the format expected by Apps Script
            const filesData = await Promise.all(files.map(async (file) => ({
                name: file.name,
                type: file.type || 'application/octet-stream',
                content: await fileToBase64(file)
            })));

            const payload = {
                files: filesData
            };

            const response = await fetch(APPS_SCRIPT_URL, {
                method: 'POST',
                mode: 'cors',
                headers: {
                    'Content-Type': 'text/plain'
                },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`Upload failed: ${response.status}`);
            }

            return await response.json();
        }

        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = form.querySelector('.btn-submit');
            const originalText = submitBtn.innerHTML;

            function updateStatus(message) {
                submitBtn.innerHTML = `<span class="material-icons">hourglass_empty</span> ${message}`;
            }

            updateStatus('Envoi en cours...');
            submitBtn.disabled = true;

            // Collect form data as JSON
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => {
                if (data[key]) {
                    if (Array.isArray(data[key])) {
                        data[key].push(value);
                    } else {
                        data[key] = [data[key], value];
                    }
                } else {
                    data[key] = value;
                }
            });

            // Add metadata
            data._submittedAt = new Date().toISOString();
            data._formName = 'Questionnaire Diagnostic Simplifié - Tunisian Campers';

            try {
                // Upload files to Google Drive first (if any)
                let driveUploadResult = null;
                if (uploadedFiles.length > 0) {
                    updateStatus(`Envoi de ${uploadedFiles.length} fichier(s) vers Google Drive...`);

                    try {
                        driveUploadResult = await uploadAllFilesToGoogleDrive(uploadedFiles);
                        console.log('Drive upload result:', driveUploadResult);

                        if (driveUploadResult.success) {
                            // Add folder URL and file links to form data
                            data._documentsFolderUrl = driveUploadResult.folderUrl;
                            if (driveUploadResult.files && driveUploadResult.files.length > 0) {
                                data._documentsUploaded = driveUploadResult.files.map(f => `${f.name}: ${f.url}`).join('\n');
                            }
                        }
                    } catch (uploadError) {
                        console.error('Drive upload error:', uploadError);
                        // Continue with form submission even if file upload fails
                        data._documentsUploadError = `Échec upload: ${uploadError.message}`;
                        data._documentsToSendManually = uploadedFiles.map(f => f.name).join(', ');
                    }
                }

                updateStatus('Envoi du questionnaire...');

                // Submit to Formspree as JSON
                const response = await fetch(`https://formspree.io/f/${FORMSPREE_ID}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    // Mark questionnaire as complete for index.html
                    localStorage.setItem('questionnaireComplete', 'true');

                    // Clear saved form data after successful submission
                    localStorage.removeItem(STORAGE_KEY);

                    // Show success message
                    let successMessage = 'Merci ! Votre questionnaire a été soumis avec succès.\n\nNous analyserons vos réponses avant notre première réunion.';

                    if (uploadedFiles.length > 0 && driveUploadResult && driveUploadResult.success) {
                        successMessage += `\n\n📎 ${uploadedFiles.length} document(s) téléchargé(s) vers Google Drive avec succès.`;
                    } else if (uploadedFiles.length > 0) {
                        successMessage += `\n\n⚠️ Les documents n'ont pas pu être envoyés automatiquement. Veuillez les envoyer par email à: ${EMAIL_TO}`;
                    }
                    alert(successMessage);

                    submitBtn.innerHTML = '<span class="material-icons">check</span> Envoyé !';
                    submitBtn.style.background = 'linear-gradient(135deg, var(--success) 0%, #357D23 100%)';
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    console.error('Formspree error:', errorData);
                    throw new Error('Submission failed');
                }
            } catch (error) {
                console.error('Submission error:', error);
                alert('Une erreur est survenue lors de l\'envoi. Vos réponses ont été sauvegardées localement.\n\nVeuillez réessayer ou contacter votre consultant.');
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
